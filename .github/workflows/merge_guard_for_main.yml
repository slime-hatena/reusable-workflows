name: '[Reusable] Merge guard for main'
on:
  workflow_call:
jobs:
  check_pr_title:
    if: (!contains(github.event.pull_request.title, '[release skip]')) && github.head_ref != 'develop' && github.head_ref != 'hotfix' && github.event.pull_request.merged == false
    runs-on: ubuntu-latest
    steps:
      - run: 'echo ${{ github.event.pull_request.title }}'
  close_pr:
    needs: [check_pr_title]
    uses: slime-hatena/reusable-workflows/.github/workflows/_internal_close_pr.yml@main
    with:
      body: |
        ‚ö†Ô∏è **Merge Guard Activated** ‚ö†Ô∏è

        It looks like you're trying to merge a branch named \`${{ github.head_ref }}\` into \`main\`.
        To maintain a clean and stable \`main\` branch, please ensure that all changes are merged into \`develop\` or \`hotfix\` branches first. Once those branches are up-to-date and tested, you can then merge them into \`main\`.

        If you absolutely need to merge due to CI settings or an emergency, please start the title with \`[release skip]\`.

        Thank you for your understanding and cooperation! üôè
